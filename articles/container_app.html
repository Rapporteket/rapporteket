<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Rapporteket as container application • rapporteket</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Rapporteket as container application">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rapporteket</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/container_app.html">Rapporteket as container application</a></li>
    <li><a class="dropdown-item" href="../articles/exgr.html">Hva er Rapporteket?</a></li>
    <li><a class="dropdown-item" href="../articles/generell_informasjon.html">Rapporteket, generell informasjon</a></li>
    <li><a class="dropdown-item" href="../articles/hva_hvorfor_hvordan.html">Rapporteket, hva, hvorfor, hvordan? (FAQ)</a></li>
    <li><a class="dropdown-item" href="../articles/kort_introduksjon.html">Kort om Rapporteket</a></li>
    <li><a class="dropdown-item" href="../articles/short_introduction.html">Rapporteket: a Short Introduction</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Rapporteket/rapporteket/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Rapporteket as container application</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Rapporteket/rapporteket/blob/master/vignettes/container_app.Rmd" class="external-link"><code>vignettes/container_app.Rmd</code></a></small>
      <div class="d-none name"><code>container_app.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="short-introduction">Short introduction<a class="anchor" aria-label="anchor" href="#short-introduction"></a>
</h2>
<p>Since 2019 <a href="https://rapporteket.github.io/rapporteket/" class="external-link">Rapporteket</a> has
been provided as <a href="https://shiny.rstudio.com/" class="external-link">R-shiny
applications</a> hosted by <a href="https://www.rstudio.com/products/shiny/shiny-server/" class="external-link">shiny-server</a>.
From 2025 on, applications will be migrated to standalone container
applications hosted in a <a href="https://kubernetes.io/" class="external-link">kubernetes</a>
cluster. This document proposes methods that aim to provide an agile and
robust process from development to deployment throughout the application
lifecycle. As such, this document is also meant to be a primer for
discussions on further improvements and refinements.</p>
</div>
<div class="section level2">
<h2 id="container-content">Container content<a class="anchor" aria-label="anchor" href="#container-content"></a>
</h2>
<p>In this set-up, each registry will be represented as a standalone
container application at Rapporteket, <em>i.e.</em> deployment will be
based on registry specific container images. However, registries at
Rapporteket all share a common set of features such as system
environment and underlying software (<em>e.g.</em> <a href="https://cran.r-project.org/" class="external-link">R</a>). These will all be established
as a base container image that all registry container images are built
upon. Both types of container images are described below.</p>
<div class="section level3">
<h3 id="base-container-image">Base container image<a class="anchor" aria-label="anchor" href="#base-container-image"></a>
</h3>
<p>This image is built on <a href="https://releases.ubuntu.com/" class="external-link">Ubuntu
LTS</a>, common system libraries, <a href="https://cran.r-project.org/sources.html" class="external-link">R-release</a> and common
<a href="https://en.wikipedia.org/wiki/R_package" class="external-link">R-packages</a>.
Relevant system locale settings are also defined in this image. The
outset is provided by <a href="https://github.com/rocker-org/rocker-versioned2/blob/master/README.md" class="external-link">rocker/r-verse</a>
that keeps track of whatever applies to Ubuntu LTS and R-release.
Specifications for building the base image is provided by the <a href="https://github.com/Rapporteket/base-r/blob/main/Dockerfile" class="external-link">corresponding
Dockerfile</a>.</p>
</div>
<div class="section level3">
<h3 id="application-container-image">Application container image<a class="anchor" aria-label="anchor" href="#application-container-image"></a>
</h3>
<p>Registry R-shiny applications are added on top of the <a href="https://github.com/Rapporteket/base-r" class="external-link">base image</a>. Source code
management for each registry application is hosted by the <a href="https://github.com/Rapporteket/" class="external-link">Rapporteket organization at
GitHub</a> where the respective Dockerfiles for building these images
also resides.</p>
</div>
</div>
<div class="section level2">
<h2 id="pipeline-for-continuous-integration-and-delivery-cicd">Pipeline for continuous integration and delivery (CI/CD)<a class="anchor" aria-label="anchor" href="#pipeline-for-continuous-integration-and-delivery-cicd"></a>
</h2>
<p>To ensure that changes to applications at Rapporteket can be
delivered in a timely and reliable manner specific workflows are
adopted. Pipelines for both the base image and registry applications are
illustrated below.</p>
<div class="float">
<img src="base_image.png" alt="Base container image workflow"><div class="figcaption">Base container image workflow</div>
</div>
<div class="float">
<img src="app_image.png" alt="Registry application container image workflow"><div class="figcaption">Registry application container image
workflow</div>
</div>
</div>
<div class="section level2">
<h2 id="cicd-tools-and-methods">CI/CD tools and methods<a class="anchor" aria-label="anchor" href="#cicd-tools-and-methods"></a>
</h2>
<p>Vulnerability test and monitoring of container images are performed
by <a href="https://snyk.io/" class="external-link">snyk</a>. The base container image is
monitored by weekly scans to detect emerging threats and changes to
underlying code is also scanned as part of all <a href="https://www.pagerduty.com/resources/learn/what-is-a-pull-request/" class="external-link">pull
requests</a> to prevent new vulnerabilities from entering the main
project. Currently, vulnerabilities with low or medium severity are
accepted, high and critical are not.</p>
<p>As all code repositories are managed at GitHub, <a href="https://docs.github.com/en/actions" class="external-link">Github Actions</a> are used to
enforce policies and run CI/CD tasks. Execution of such tasks are both
scheduled and triggered by code update requests.</p>
</div>
<div class="section level2">
<h2 id="deployment">Deployment<a class="anchor" aria-label="anchor" href="#deployment"></a>
</h2>
<p>In summary, deployment of registry applications follow a two step
process where development and deploy tasks are interconnected. In the
first step an application image is built from the <em>main</em> branch
and deployed to a <em>quality assurance</em> (QA) environment for
functional testing. After successful testing the second step can
commence where corresponding application code is tagged for release and
from which a new image is built and deployed to a <em>production</em>
environment. The overall process is illustrated below and further
details are described in the following sections. <img src="deploy.png" alt="Suggested deployment process."></p>
<div class="section level3">
<h3 id="quality-assurance-qa">Quality assurance (QA)<a class="anchor" aria-label="anchor" href="#quality-assurance-qa"></a>
</h3>
<p>Any changes applied to the main branch of the application code
repository will trigger a build pipeline that if successful will push a
new application image to the <em>Dockerhub image registry</em>. Any new
image tagged by the name of the main branch in the Dockerhub image
registry will trigger the deploy pipeline where the new image is pulled
by the <em>Harbour image registry</em> and scanned for vulnerabilities.
If this scanning is not successful, <em>i.e.</em> that unacceptable
security issues are identified, a summary of relevant issues is reported
to the development team via Rapporteket standard email inbox. Upon a
successful vulnerability scanning the image will be deployed to the QA
environment from where it can be tested, <em>e.g.</em> by an end user
test team. If tests are successful the release process can commence, and
if not the QA-loop will have to start all over again. The QA deploy step
is fully automatic and will trigger on any changes to the main code
branch.</p>
</div>
<div class="section level3">
<h3 id="production">Production<a class="anchor" aria-label="anchor" href="#production"></a>
</h3>
<p>Once tests are accepted a new release version of the corresponding
code will be made and tagged by use of <a href="https://semver.org/" class="external-link">semantic versioning</a>. A new release will
trigger an automated publish pipeline that will push a new image to the
<em>Dockerhub image registry</em>. This image is tagged according to the
version number of the code release and a static “production” tag that
will serve the same purpose at the often used <em>latest</em> tag. These
images will be pulled by the <em>Harbour image registry</em> and scanned
for vulnerabilities following the exact same approach as for the QA
process. When successful, the application image will be deployed to the
production environment. In case a roll-back is needed, any existing
image tagged with a semantic version number may be re-tagged with the
static “production” tag. For this proof of concept, a roll-back will be
part of the CI-process in either the development or deployment workflow.
Overall, the production deploy step may therefore apply both automated
and manual processes. This approach may well be adjusted to meet not yet
known future demands for tighter control and change management.</p>
</div>
<div class="section level3">
<h3 id="vulnerability-scanning">Vulnerability scanning<a class="anchor" aria-label="anchor" href="#vulnerability-scanning"></a>
</h3>
<p>In the above, the deployment process is described in the case when
application code changes and a new version is to be deployed. Since new
vulnerabilities may well emerge for an application image that has
already been deployed to the QA or production environment security
scanning will also be run on a schedule. In this case and if new and
unacceptable threats are identified the application image will be left
running but the results of the vulnerability scanning will be reported
in the same way as describe above.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Are Edvardsen, Lena Ringstad Olsen, Kevin Otto Thon.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
