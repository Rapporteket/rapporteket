<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rapporteket">
<title>Rapporteket as container application â€¢ rapporteket</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Rapporteket as container application">
<meta property="og:description" content="rapporteket">
<meta property="og:image" content="/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rapporteket</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/container_app.html">Rapporteket as container application</a>
    <a class="dropdown-item" href="../articles/exgr.html">Hva er Rapporteket?</a>
    <a class="dropdown-item" href="../articles/generell_informasjon.html">Rapporteket, generell informasjon</a>
    <a class="dropdown-item" href="../articles/hva_hvorfor_hvordan.html">Rapporteket, hva, hvorfor, hvordan? (FAQ)</a>
    <a class="dropdown-item" href="../articles/kort_introduksjon.html">Kort om Rapporteket</a>
    <a class="dropdown-item" href="../articles/short_introduction.html">Rapporteket: a Short Introduction</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/Rapporteket/rapporteket/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Rapporteket as container application</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Rapporteket/rapporteket/blob/HEAD/vignettes/container_app.Rmd" class="external-link"><code>vignettes/container_app.Rmd</code></a></small>
      <div class="d-none name"><code>container_app.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="short-introduction">Short introduction<a class="anchor" aria-label="anchor" href="#short-introduction"></a>
</h2>
<p>Since 2019 <a href="https://rapporteket.github.io/rapporteket/" class="external-link">Rapporteket</a> has
been provided as <a href="https://shiny.rstudio.com/" class="external-link">R-shiny
applications</a> hosted by <a href="https://www.rstudio.com/products/shiny/shiny-server/" class="external-link">shiny-server</a>.
From 2023 on, applications will be migrated to standalone container
applications hosted in a <a href="https://kubernetes.io/" class="external-link">kubernetes</a>
cluster. This document proposes methods that aim to provide an agile and
robust process from development to deployment throughout the application
lifecycle. As such, this document is also meant to be a primer for
discussions on further improvements and refinements.</p>
</div>
<div class="section level2">
<h2 id="container-content">Container content<a class="anchor" aria-label="anchor" href="#container-content"></a>
</h2>
<p>In this set-up, each registry will be represented as a standalone
container application at Rapporteket, <em>i.e.</em> deployment will be
based on registry specific container images. However, registries at
Rapporteket all share a common set of features such as system
environment and underlying software (<em>e.g.</em> <a href="https://cran.r-project.org/" class="external-link">R</a>). These will all be established
as a base container image that all registry container images are built
upon. Both types of container images are described below.</p>
<div class="section level3">
<h3 id="base-container-image">Base container image<a class="anchor" aria-label="anchor" href="#base-container-image"></a>
</h3>
<p>This image is built on <a href="https://releases.ubuntu.com/" class="external-link">Ubuntu
LTS</a>, common system libraries, <a href="https://cran.r-project.org/sources.html" class="external-link">R-release</a> and common
<a href="https://en.wikipedia.org/wiki/R_package" class="external-link">R-packages</a>.
Relevant system locale settings are also defined in this image. The
outset is provided by <a href="https://github.com/rocker-org/rocker-versioned2/blob/master/README.md" class="external-link">rocker/r-verse</a>
that keeps track of whatever applies to Ubuntu LTS and R-release.
Specifications for building the base image is provided by the <a href="https://github.com/Rapporteket/base-r/blob/main/Dockerfile" class="external-link">corresponding
Dockerfile</a>.</p>
</div>
<div class="section level3">
<h3 id="application-container-image">Application container image<a class="anchor" aria-label="anchor" href="#application-container-image"></a>
</h3>
<p>Registry R-shiny applications are added on top of the <a href="https://github.com/Rapporteket/base-r" class="external-link">base image</a>. Source code
management for each registry application is hosted by the <a href="https://github.com/Rapporteket/" class="external-link">Rapporteket organization at
GitHub</a> where the respective Dockerfiles for building these images
also resides.</p>
</div>
</div>
<div class="section level2">
<h2 id="pipeline-for-continuous-integration-and-delivery-cicd">Pipeline for continuous integration and delivery (CI/CD)<a class="anchor" aria-label="anchor" href="#pipeline-for-continuous-integration-and-delivery-cicd"></a>
</h2>
<p>To ensure that changes to applications at Rapporteket can be
delivered in a timely and reliable manner specific workflows are
adopted. Pipelines for both the base image and registry applications are
illustrated below.</p>
<div class="figure">
<img src="base_image.png" alt=""><p class="caption">Base container image workflow</p>
</div>
<div class="figure">
<img src="app_image.png" alt=""><p class="caption">Registry application container image workflow</p>
</div>
</div>
<div class="section level2">
<h2 id="cicd-tools-and-methods">CI/CD tools and methods<a class="anchor" aria-label="anchor" href="#cicd-tools-and-methods"></a>
</h2>
<p>Vulnerability test and monitoring of container images are performed
by <a href="https://snyk.io/" class="external-link">snyk</a>. The base container image is
monitored by weekly scans to detect emerging threats and changes to
underlying code is also scanned as part of all <a href="https://www.pagerduty.com/resources/learn/what-is-a-pull-request/" class="external-link">pull
requests</a> to prevent new vulnerabilities from entering the main
project. Currently, vulnerabilities with low or medium severity are
accepted, high and critical are not.</p>
<p>As all code repositories are managed at GitHub, <a href="https://docs.github.com/en/actions" class="external-link">Github Actions</a> are used to
enforce policies and run CI/CD tasks. Execution of such tasks are both
scheduled and triggered by code update requests.</p>
</div>
<div class="section level2">
<h2 id="deployment">Deployment<a class="anchor" aria-label="anchor" href="#deployment"></a>
</h2>
<p>In summary, deployment of registry applications follow a two step
process where development and deploy tasks are interconnected. In the
first step an application image is built from the <em>main</em> branch
and deployed to a <em>quality assurance</em> (QA) environment for
functional testing. After successful testing the second step can
commence where corresponding application code is tagged for release and
from which a new image is built and deployed to a <em>production</em>
environment. The overall process is illustrated below and further
details are described in the following sections. <img src="deploy.png" alt="Suggested deployment process."></p>
<div class="section level3">
<h3 id="quality-assurance-qa">Quality assurance (QA)<a class="anchor" aria-label="anchor" href="#quality-assurance-qa"></a>
</h3>
<p>Any changes applied to the main branch of the application code
repository will trigger a build pipeline that if successful will push a
new application image to the <em>Dockerhub image registry</em>. Any new
image tagged by the name of the main branch in the Dockerhub image
registry will trigger the deploy pipeline where the new image is pulled
by the <em>Harbour image registry</em> and scanned for vulnerabilities.
If this scanning is not successful, <em>i.e.</em> that unacceptable
security issues are identified, a summary of relevant issues is reported
to the development team via &lt;<strong>please select:</strong> email,
slack, other channel&gt;. Upon a successful vulnerability scanning the
image will be deployed to the QA environment from where it can be
tested, <em>e.g.</em> by an end user test team. If tests are successful
the release process can commence, and if not the QA-loop will have to
start all over again. The QA deploy step is &lt;<strong>please
check:</strong> fully automatic&gt; and will trigger on any changes to
the main code branch.</p>
</div>
<div class="section level3">
<h3 id="production">Production<a class="anchor" aria-label="anchor" href="#production"></a>
</h3>
<p>Once tests are accepted a new release version of the corresponding
code will be made and tagged by use of <a href="https://semver.org/" class="external-link">semantic versioning</a>. A new release will
trigger an automated publish pipeline that will push a new image to the
<em>Dockerhub image registry</em>. This image is tagged according to the
version number of the code release. Any new image tagged with a semantic
version number taking precedence over existing ones will be pulled by
the <em>Harbour image registry</em> and scanned for vulnerabilities
&lt;<strong>please check:</strong> following the exact same approach as
for the QA process&gt;. When successful, a final approval will have to
be made. &lt;<strong>please describe both actions taken and how and to
whom this will be reported</strong>&gt;. After approval the application
image will be deployed to the production environment. Overall, the
production deploy step will apply both automated and manual
processes.</p>
</div>
<div class="section level3">
<h3 id="vulnerability-scanning">Vulnerability scanning<a class="anchor" aria-label="anchor" href="#vulnerability-scanning"></a>
</h3>
<p>In the above, the deployment process is described in the case when
application code changes and a new version is to be deployed. Since new
vulnerabilities may well emerge for an application image that has
already been deployed to the QA or production environment security
scanning will also be run on a schedule. In this case and if new and
unacceptable threats are identified the application image will be
&lt;<strong>please check:</strong> left running&gt; but the results of
the vulnerability scanning will be reported in the same way as describe
above.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Are Edvardsen, Lena Ringstad Olsen, Kevin Otto Thon.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
